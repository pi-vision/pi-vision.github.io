---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import FocusGrid from "../../components/FocusGrid.astro";
import { getCollectionName, focusHref } from "../../data/focusCollections";

const focusMeta = (await getCollection('focus_meta'))
  .sort((a,b) => (a.data.order ?? 999) - (b.data.order ?? 999));

const focusItems = await Promise.all(focusMeta.map(async (entry) => {
  const collectionName = getCollectionName(entry.slug);
  let gallery = [];
  if (collectionName) {
    const items = await getCollection(collectionName);
    gallery = items
      .sort((a,b) => (a.data.order ?? 999) - (b.data.order ?? 999))
      .slice(0, 6)
      .map((item) => ({
        image: item.data.image,
        label: item.data.title,
        alt: item.data.title,
        href: `${focusHref(entry.slug)}#${entry.slug}-${item.slug}`,
      }));
  }

  return {
    title: entry.data.title,
    image: entry.data.image,
    kicker: entry.data.kicker,
    blurb: entry.data.blurb,
    href: focusHref(entry.slug),
    gallery,
    slug: entry.slug,
  };
}));
---
<BaseLayout title="Research Focus">
  <h1 class="text-3xl font-semibold mb-6">Research Focus</h1>

  {focusItems.length > 0 && (
    <FocusGrid heading={null} items={focusItems} />
  )}
</BaseLayout>
